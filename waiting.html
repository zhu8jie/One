
<!DOCTYPE html>
<html lang="zh-cn" >
<head>
<title>修1112223333改 camp | Djang111o 站点管理员</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf8">
<link rel="stylesheet" type="text/css" href="../static/admin/css/base.css" />
<link rel="stylesheet" type="text/css" href="../static/admin/css/forms.css" />
<!--[if lte IE 7]><link rel="stylesheet" type="text/css" href="/static/admin/css/ie.css" /><![endif]-->

<script type="text/javascript">window.__admin_media_prefix__ = "/static/admin/";</script>
<script type="text/javascript">window.__admin_utc_offset__ = "28800";</script>

<script type="text/javascript" src="/admin/jsi18n/"></script>
<script type="text/javascript" src="/static/admin/js/core.js"></script>
<script type="text/javascript" src="/static/admin/js/admin/RelatedObjectLookups.js"></script>
<script type="text/javascript" src="/static/admin/js/jquery.js"></script>
<script type="text/javascript" src="/static/admin/js/jquery.init.js"></script>
<script type="text/javascript" src="/static/admin/js/actions.js"></script>

<meta name="robots" content="NONE,NOARCHIVE" />
</head>
<body class=" app-camp model-camp change-form">
<!-- Container -->
<div id="container">
    <!-- Header -->
    <div id="header">
        <div id="branding">
        <h1 id="site-name"><a href="/admin/">Django 管理</a></h1>
        </div>        
        <div id="user-tools">
            欢迎，
            <strong>coach</strong>.
            <a href="/admin/password_change/">修改密码</a> /
            <a href="/admin/logout/">注销</a>
        </div>
    </div>
    <!-- END Header -->
<div class="breadcrumbs">
<a href="/admin/">首页</a>
&rsaquo; <a href="/admin/camp/">Camp</a>
&rsaquo; <a href="/admin/camp/camp/">Camps</a>
&rsaquo; Camp object
</div>
    <!-- Content -->
    <div id="content" class="colM">
        <h1>学员延期操作</h1>
        <div id="content-main">
  <ul class="object-tools">
<!--<li>
        <a href="/admin/camp/camp/109/history/" class="historylink">历史</a>
    </li>-->
  </ul>


<div>
  <fieldset class="module aligned ">
        <div class="form-row field-camp_name">
                <div>
                        <label for="id_camp_name">member phone:</label>
                            <span id="id_phone" style="padding:3px 10px 0 0; float:left;">18888842898</span>
                </div>
        </div>
        <div class="form-row field-camp_name" id="camp_div" style="display:none">
                <div>
                        <label for="id_camp_name">已有分班:</label>
                            <span id="id_camp_name" style="padding:3px 10px 0 0; float:left;"></span>
                </div>
        </div>
        <div class="form-row field-camp_starttime">
                <div>
                        <label class="required" for="startlearn_timestamp" style="height:26px; line-height:26px;">延迟日期:</label>
                        
                            <input id="id_startlearn_timestamp" name="startlearn_timestamp" type="date" value="" />
                </div>
            
        </div>
        <div class="form-row field-camp_starttime">
                <div>
                        <label class="required" for="startlearn_timestamp" style="height:26px; line-height:26px;">延迟备注:</label>
                        
                            <textarea id="id_comment" name="comment" rows=8 cols=30></textarea>
                </div>
            
        </div>

</fieldset>
<div class="submit-row">
<input type="button" value="提交" id="id_submit" class="default" name="_save" />
<!--    <p class="deletelink-box"><a href="/admin/camp/camp/109/delete/" class="deletelink">删除</a></p>
<input type="submit" value="保存并增加另一个" name="_addanother" />
<input type="submit" value="保存并继续编辑" name="_continue" />-->
</div>
<script type="text/javascript">
(function($) {
    var field;


})(django.jQuery);
</script>


<input type="hidden" name="uid" id="uid">
<input type="hidden" name="camp_member_status" id="camp_member_status">
<input type="hidden" name="camp_name" id="camp_name">

</div>
</div>

<script type="text/javascript" src="http://ldlpic.oss-cn-hangzhou.aliyuncs.com/sprogram_order/_1463658613229/js/lib/zepto.min.js?"></script>
<script type="text/javascript" src="http://ldlpic.oss-cn-hangzhou.aliyuncs.com/sprogram_order/_1463658613229/js/lib/common.js"></script>

<script type="text/javascript">
function getUrlParam(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
    var r = window.location.search.substr(1).match(reg);  //匹配目标参数
    if (r != null) return decodeURI(r[2]); return null; //返回参数值
}


var uid = getUrlParam('uid');
var phone = getUrlParam('phone');
var camp_member_status = getUrlParam('camp_member_status');
var camp_name = getUrlParam('camp_name');
var transact_id = getUrlParam('transact_id');
var locationUrl = getUrlParam('url');

if(camp_member_status == 1){
    $('#id_camp_name').html(camp_name);
    $('#camp_div').show();
}
$('#id_phone').html(phone);

$('#uid').val(uid);
$('#camp_member_status').val(camp_member_status);

$('#id_submit').click(function(){
    var timestamp = $('#id_startlearn_timestamp').val();
    var comment = $('#id_comment').val();

    if(!timestamp){
        alert('请填写延期日期。');
        return false;
    }

    var data = {
        'uid':uid,
        'camp_member_status':camp_member_status,
        'transact_id':transact_id,
        'camp_name':camp_name,
        'startlearn_timestamp':Date.parse(timestamp)/1000,
        'comment':comment
    };
    if(camp_member_status == 1){
        if(confirm('该学员已有分班，处理延期将会取消其分班，您确认继续吗？')){
            submitAction(data);
        }
    }else{
        submitAction(data);
    }

});

function submitAction(jsonData){
    $.ajax({
        type: "POST",
        url: "http://121.43.145.85:11997/v1/rest/camp/delay_action",
        data:jsonData,
        dataType: "json",
        success: function(d){
            alert('操作成功');
            setTimeout(function(){
                location.href=locationUrl;
            }, 3000);
        }
    });
}


</script>

        
        <br class="clear" />
    </div>
    <!-- END Content -->

    <div id="footer"></div>
</div>
<!-- END Container -->

</body>
</html>
